#!/usr/bin/env python
from subprocess import call
import onetimepass as otp

def clear():
	call(["clear"])

def allow():
	clear()
	print 'accepted'
	# run bash/zsh
	call(["exec","-l","$SHELL"],shell=true)
	# exit with true
	exit(0)

def deny():
	clear()
	print 'denied'
	# exit with error
	exit(1)

try:
	# secret key
	sec = "" # enter your key here
	# check validity
	if otp.valid_totp(token=raw_input(':>'), secret=sec, token_length=8):
		allow()
	else:
		deny()
except KeyboardInterrupt:
	# prevent user keyboard interrupt reporting debug data.
        clear()
	deny()
except Exception,e:
	clear()
	# any exception deny
	print(e)
	deny()

# default deny
deny()
